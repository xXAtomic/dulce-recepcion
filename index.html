<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dulce Recepci칩n - Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@300;500;700&display=swap');
        body { font-family: 'Quicksand', sans-serif; }
        h1, h2, h3 { font-family: 'Pacifico', cursive; }
        .btn-wsp { background-color: #25D366; }
        .btn-wsp:hover { background-color: #128C7E; }
        
        /* Estilo para el scrollbar del modal */
        .modal-scroll::-webkit-scrollbar { width: 8px; }
        .modal-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .modal-scroll::-webkit-scrollbar-thumb { background: #fdba74; border-radius: 4px; }
    </style>
</head>
<body class="bg-orange-50 text-gray-800">

    <nav class="bg-white shadow-md fixed w-full z-10 top-0 transition-all duration-300">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-2xl text-orange-600 hover:scale-105 transition cursor-pointer" onclick="window.scrollTo(0,0)">Dulce Recepci칩n 游꼵</h1>
            <button onclick="toggleCart()" class="relative text-orange-600 text-2xl hover:text-orange-800 transition">
                <i class="fas fa-shopping-cart"></i>
                <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center transform scale-0 transition-transform duration-200">0</span>
            </button>
        </div>
    </nav>

    <header class="mt-16 bg-orange-100 py-12 text-center px-4 border-b-4 border-orange-200">
        <h2 class="text-4xl md:text-6xl mb-4 text-orange-700 drop-shadow-sm">Navidad con sabor a Hogar</h2>
        <p class="text-lg mb-6 max-w-2xl mx-auto text-gray-700 font-medium">Galletas de jengibre, pan de pascua y reposter칤a hecha con amor. Haz tu pedido y rec칤belo con cari침o.</p>
        <a href="#productos" class="inline-block bg-orange-500 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-orange-600 hover:shadow-xl transition transform hover:-translate-y-1">Ver Delicias</a>
    </header>

    <section id="productos" class="max-w-6xl mx-auto p-4 py-10">
        <h2 class="text-4xl text-center mb-10 text-orange-800">Nuestros Productos</h2>
        <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            </div>
    </section>

    <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex justify-center items-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col md:flex-row relative">
            <button onclick="closeProductModal()" title="Cerrar" aria-label="Cerrar" class="absolute top-4 right-4 text-gray-500 hover:text-red-500 z-10 text-2xl bg-white rounded-full w-8 h-8 flex items-center justify-center shadow">
                <i class="fas fa-times" aria-hidden="true"></i>
                <span class="sr-only">Cerrar</span>
            </button>
            
            <div class="w-full md:w-1/2 bg-gray-100 p-4 flex flex-col justify-center">
                <img id="modal-main-img" src="" alt="" class="w-full h-64 md:h-80 object-contain rounded-lg shadow-sm mb-4 bg-white">
                <div id="modal-thumbnails" class="flex gap-2 overflow-x-auto py-2 px-1 justify-center">
                    </div>
            </div>

            <div class="w-full md:w-1/2 p-6 md:p-8 overflow-y-auto modal-scroll bg-white flex flex-col justify-between">
                <div>
                    <h3 id="modal-title" class="text-3xl text-orange-700 mb-2"></h3>
                    <p id="modal-price" class="text-2xl font-bold text-green-600 mb-4"></p>
                    <p id="modal-desc" class="text-gray-600 leading-relaxed mb-6"></p>
                </div>
                <button id="modal-add-btn" class="w-full bg-orange-500 text-white py-3 rounded-xl font-bold shadow-md hover:bg-orange-600 transition flex justify-center items-center gap-2 text-lg">
                    <i class="fas fa-cart-plus"></i> Agregar al Pedido
                </button>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex justify-end transition-opacity duration-300">
        <div class="bg-white w-full md:w-96 h-full shadow-2xl flex flex-col transform transition-transform duration-300 translate-x-0">
            <div class="p-4 bg-orange-600 text-white flex justify-between items-center shadow-md">
                <h3 class="font-bold text-lg font-sans">Tu Pedido 游</h3>
                <button onclick="toggleCart()" class="text-2xl hover:text-gray-200">&times;</button>
            </div>
            
            <div id="cart-items" class="flex-1 p-4 overflow-y-auto bg-gray-50">
                </div>

            <div class="p-6 border-t bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                <div class="flex justify-between text-xl font-bold mb-4 text-gray-800">
                    <span>Total:</span>
                    <span id="cart-total">$0</span>
                </div>
                <button onclick="checkoutWhatsApp()" class="w-full btn-wsp text-white py-4 rounded-xl font-bold shadow-lg flex justify-center items-center gap-2 hover:scale-[1.02] transition text-lg">
                    <i class="fab fa-whatsapp text-2xl"></i> Enviar a Dulce Recepci칩n
                </button>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white text-center py-8 mt-10">
        <p class="text-lg font-bold font-sans">Dulce Recepci칩n 游꼵</p>
        <p class="text-sm text-gray-400 mt-2">Hecho con 仇벒잺 en Quilpue</p>
        <div class="mt-4 space-x-4">
            <a href="#" class="text-gray-400 hover:text-white transition" title="Instagram" aria-label="Instagram">
                <i class="fab fa-instagram text-2xl" aria-hidden="true"></i>
                <span class="sr-only">Instagram</span>
            </a>
        </div>
    </footer>

    <script>
        // --- CONFIGURACI칍N DE PRODUCTOS ---
        const products = [
            {
                id: 1,
                name: "Caja 'Mini Encanto Navide침o'",
                desc: "Una cajita alegre con 6 galletas de jengibre decoradas a mano. Cada una trae un gui침o festivo: botitas rojas, bastones dulces, coronas brillantes y arbolitos que parecen contar historias. Un detalle perfecto para endulzar la tarde o regalar un abrazo comestible.",
                price: 4500,
                images: [
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/6%20galletas3.png", // Foto principal
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/6%20galletas1.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/6%20galletas4.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/6%20galletas5.png"
                ]
            },
            {
                id: 2,
                name: "Caja 'Ventana al Polo Norte'",
                desc: "12 galletas decoradas que se asoman por una cajita con ventana, como peque침os duendes listos para saludar. Incluye decoraci칩n tem치tica y una tarjeta para escribir esa frase que derrite el coraz칩n m치s fr칤o del invierno.",
                price: 8500,
                images: [
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/12%20galletas.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/12%20galletas1.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/12%20galletas2.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/12%20galletas3.png"
                ]
            },
            {
                id: 3,
                name: "Caja Regalo 'Nochebuena Casera'",
                desc: "Un tesoro gourmet: pan de pascua casero de 췋 kg acompa침ado de 8 galletas decoradas con motivos navide침os. Todo armado en una caja adornada con cari침o y una tarjeta para darle voz a tu mensaje.",
                price: 11000,
                images: [
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20y%20galletas1.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20y%20galletas.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20y%20galletas2.png"
                ]
            },
            {
                id: 4,
                name: "Pan de Pascua (췋 kg)",
                desc: "Pan de pascua casero con la abundancia de fruta confitada y frutos secos, horneado como si fuera un recuerdo de infancia. Formato mediano.",
                price: 5000,
                images: [
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20de%20pascua4.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20de%20pascua2.png"
                ]
            },
            {
                id: 5,
                name: "Pan de Pascua con Glaseado (췋 kg)",
                desc: "Pan de pascua casero con la abundancia de fruta confitada y frutos secos, con una rica cubierta de glaseado, horneado como si fuera un recuerdo de infancia. Formato mediano.",
                price: 5000,
                images: [
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20de%20pascua1.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20de%20pascua3.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20de%20pascua.png"
                ]
            },
            {
                id: 6,
                name: "Pan de Pascua (1 kg)",
                desc: "Pan de pascua casero con la abundancia de fruta confitada y frutos secos. Formato familiar para compartir en la mesa navide침a.",
                price: 8500,
                images: [
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20de%20pascua4.png",
                    "https://raw.githubusercontent.com/xXAtomic/dulce-recepcion/refs/heads/main/fotos/pan%20de%20pascua2.png"
                ]
            }
        ];

        // Cambiamos 'cart' a un Map o un objeto para guardar cantidades
        // Ejemplo: { productId: { productData, quantity } }
        let cart = new Map(); // Usaremos Map para almacenar los 칤tems 칰nicos y sus cantidades

        // --- RENDERIZADO DE PRODUCTOS ---
        const productList = document.getElementById('product-list');
        products.forEach(prod => {
            const card = document.createElement('div');
            card.className = "bg-white rounded-2xl shadow-md overflow-hidden hover:shadow-2xl transition duration-300 border border-orange-50 group flex flex-col h-full";
            
            const mainImage = prod.images[0];

            card.innerHTML = `
                <div class="relative overflow-hidden h-64 cursor-pointer" onclick="openProductModal(${prod.id})">
                    <img src="${mainImage}" alt="${prod.name}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition duration-300 flex items-center justify-center">
                        <span class="bg-white text-orange-600 px-4 py-2 rounded-full opacity-0 group-hover:opacity-100 transition duration-300 font-bold shadow-lg transform translate-y-4 group-hover:translate-y-0">Ver Detalle</span>
                    </div>
                </div>
                <div class="p-5 flex flex-col flex-grow">
                    <h3 class="font-bold text-xl text-gray-800 mb-2 font-sans leading-tight cursor-pointer hover:text-orange-600 transition" onclick="openProductModal(${prod.id})">${prod.name}</h3>
                    <p class="text-gray-500 text-sm mb-4 line-clamp-2 flex-grow">${prod.desc}</p>
                    <div class="flex justify-between items-center mt-auto pt-4 border-t border-gray-100">
                        <span class="text-xl font-bold text-orange-600">$${prod.price.toLocaleString('es-CL')}</span>
                        <button onclick="addToCart(${prod.id})" class="bg-orange-100 text-orange-700 px-4 py-2 rounded-lg text-sm font-bold hover:bg-orange-500 hover:text-white transition">
                            <i class="fas fa-plus"></i> Agregar
                        </button>
                    </div>
                </div>
            `;
            productList.appendChild(card);
        });

        // --- L칍GICA DEL CARRITO (MODIFICADA) ---
        function addToCart(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            if (cart.has(id)) {
                cart.get(id).quantity++;
            } else {
                cart.set(id, { product: product, quantity: 1 });
            }
            renderCart();
            animateCartIcon();
        }

        function updateCartQuantity(id, change) {
            if (!cart.has(id)) return;

            const item = cart.get(id);
            item.quantity += change;

            if (item.quantity <= 0) {
                cart.delete(id);
            }
            renderCart();
        }

        function renderCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotal = document.getElementById('cart-total');

            // Calcular el n칰mero total de 칤tems (no de productos 칰nicos)
            let totalItemsInCart = 0;
            cart.forEach(item => totalItemsInCart += item.quantity);
            cartCount.innerText = totalItemsInCart;
            
            if(totalItemsInCart > 0) {
                cartCount.classList.remove('scale-0');
            } else {
                cartCount.classList.add('scale-0');
            }

            if (cart.size === 0) { // Si no hay productos 칰nicos en el carrito
                cartItemsContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-gray-400">
                        <i class="fas fa-cookie-bite text-4xl mb-2"></i>
                        <p>Tu carrito est치 vac칤o</p>
                    </div>`;
                cartTotal.innerText = '$0';
                return;
            }

            let total = 0;
            cartItemsContainer.innerHTML = '';

            cart.forEach((item) => {
                total += item.product.price * item.quantity;
                const itemEl = document.createElement('div');
                itemEl.className = "flex justify-between items-center mb-3 bg-white p-3 rounded-lg shadow-sm border border-gray-100";
                itemEl.innerHTML = `
                    <div class="flex items-center gap-3 w-3/4">
                        <img src="${item.product.images[0]}" class="w-10 h-10 rounded object-cover">
                        <div class="flex-grow">
                            <h4 class="font-bold text-xs md:text-sm text-gray-700 line-clamp-1">${item.product.name}</h4>
                            <span class="text-orange-600 font-bold text-sm">$${(item.product.price * item.quantity).toLocaleString('es-CL')}</span>
                            <span class="text-gray-500 text-xs ml-2">(${item.product.price.toLocaleString('es-CL')} c/u)</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="updateCartQuantity(${item.product.id}, -1)" class="text-gray-600 hover:text-red-500 text-lg w-7 h-7 flex items-center justify-center rounded-full hover:bg-gray-100 transition">-</button>
                        <span class="font-bold text-sm">${item.quantity}</span>
                        <button onclick="updateCartQuantity(${item.product.id}, 1)" class="text-gray-600 hover:text-green-500 text-lg w-7 h-7 flex items-center justify-center rounded-full hover:bg-gray-100 transition">+</button>
                    </div>
                `;
                cartItemsContainer.appendChild(itemEl);
            });

            cartTotal.innerText = '$' + total.toLocaleString('es-CL');
        }

        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            modal.classList.toggle('hidden');
        }
        
        function animateCartIcon() {
            const badge = document.getElementById('cart-count');
            badge.classList.add('scale-125');
            setTimeout(() => badge.classList.remove('scale-125'), 200);
        }

        // --- L칍GICA DE DETALLE DE PRODUCTO (MODAL) ---
        function openProductModal(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            document.getElementById('modal-title').innerText = product.name;
            document.getElementById('modal-price').innerText = `$${product.price.toLocaleString('es-CL')}`;
            document.getElementById('modal-desc').innerText = product.desc;
            
            const btn = document.getElementById('modal-add-btn');
            btn.onclick = () => {
                addToCart(product.id);
                closeProductModal();
                toggleCart(); 
            };

            const mainImg = document.getElementById('modal-main-img');
            const thumbnails = document.getElementById('modal-thumbnails');
            
            mainImg.src = product.images[0];
            mainImg.alt = product.name;
            thumbnails.innerHTML = '';

            if (product.images.length > 0) { // Siempre debe haber al menos una imagen
                product.images.forEach((imgSrc, idx) => {
                    const thumb = document.createElement('img');
                    thumb.src = imgSrc;
                    thumb.alt = product.name + " - imagen " + (idx + 1);
                    thumb.className = "w-16 h-16 object-cover rounded border-2 border-transparent hover:border-orange-500 cursor-pointer transition";
                    thumb.onclick = () => {
                        mainImg.src = imgSrc;
                        mainImg.alt = product.name + " - imagen " + (idx + 1);
                    };
                    thumbnails.appendChild(thumb);
                });
            }

            document.getElementById('product-modal').classList.remove('hidden');
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.add('hidden');
        }

        document.getElementById('product-modal').addEventListener('click', function(e) {
            if (e.target === this) closeProductModal();
        });

        // --- L칍GICA WHATSAPP (MODIFICADA) ---
        function checkoutWhatsApp() {
            if (cart.size === 0) { // Si no hay productos 칰nicos
                alert("Agrega productos al carrito primero 游꼵");
                return;
            }

            const phoneNumber = "56930656989";
            let message = "Hola Dulce Recepci칩n! 游꾻 Me gustar칤a hacer el siguiente pedido:%0A%0A";
            
            let total = 0;
            
            // Iteramos sobre el Map del carrito para construir el mensaje
            cart.forEach((item) => {
                total += item.product.price * item.quantity;
                message += `郊쀮잺 ${item.quantity}x ${item.product.name} ($${(item.product.price * item.quantity).toLocaleString('es-CL')})%0A`;
            });

            message += `%0A*游눯 Total a pagar: $${total.toLocaleString('es-CL')}*`;
            message += "%0A%0AQuedo atento a los datos de transferencia y coordinaci칩n de entrega.";

            const url = `https://wa.me/${phoneNumber}?text=${message}`;
            window.open(url, '_blank');
        }

        // Inicializar el carrito al cargar
        document.addEventListener('DOMContentLoaded', renderCart);
    </script>
</body>
</html>
